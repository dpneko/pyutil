
import pandas as pd
from io import StringIO 
from binance import get_klines_iter


# select start_time,end_time, sum(convert(farm_speed, decimal(32,6))*((end_time-start_time)/86400000)) as reward 
# from token_status where symbol like "j%" and farm_token_type = 30 and type=1 and farm_speed != 0 group by start_time,end_time;
csv = """start_time,end_time,reward
1623416400000,1624021200000,16660000.0000000000
1624021200000,1624626000000,15351000.0000000000
1624626000000,1625230800000,15351000.0000000000
1625230800000,1625835600000,15351000.0000000000
1625835600000,1626440400000,14994000.0000000000
1626440400000,1627045200000,14994000.0000000000
1627045200000,1627650000000,14994000.0000000000
1627650000000,1628254800000,14994000.0000000000
1628254800000,1628859600000,16303000.0000000000
1628859600000,1629464400000,17612000.0000000000
1629464400000,1630069200000,17612000.0000000000
1630069200000,1630674000000,17612000.0000000000
1630674000000,1631278800000,12593063.0000000000
1631278800000,1631883600000,12593063.0000000000
1631883600000,1632488400000,12593063.0000000000
1632488400000,1633093200000,12593063.0000000000
1633093200000,1633698000000,12593063.0000000000
1633698000000,1634302800000,12593063.0000000000
1634302800000,1634907600000,12593063.0000000000
1634907600000,1635512400000,12593063.0000000000
1635512400000,1636117200000,12593063.0000000000
1636117200000,1636135200000,374793.5410669970
1636135200000,1638536400000,49997458.4571339940
1638536400000,1639141200000,16847488.0000000000
1639141200000,1639746000000,16847488.0000000000
1639746000000,1640350800000,16847488.0000000000
1640350800000,1640955600000,16847488.0000000000
1640955600000,1641560400000,16847488.0000000000
1641560400000,1642165200000,16847488.0000000000
1642165200000,1642770000000,16847488.0000000000
1642770000000,1645189200000,67389952.0000000000
1645189200000,1647608400000,67389952.0000000000
1647608400000,1650027600000,67389952.0000000000
1650027600000,1652446800000,67389952.0000000000
1652356800000,1652961600000,1446501.0000000000
1652446800000,1654866000000,67389952.0000000000
1652961600000,1653566400000,1446501.0000000000
1653566400000,1653825600000,619929.0000000000
1654866000000,1655726400000,3026208.0415653710
1654866000000,1657285200000,58881116.0000000000"""

csv_str = StringIO(csv)
df = pd.read_csv(csv_str, sep=',')
df

klines = get_klines_iter("JSTUSDT", '1d', start=1623416400000, end=1657285200000)
df['end_time_day_start'] = df['end_time'] // 86400000 * 86400000
reward_with_price_df = pd.merge(df, klines, 'inner', left_on = 'end_time_day_start', right_on='Opentime')
(reward_with_price_df['reward'] * reward_with_price_df['Open']).sum()